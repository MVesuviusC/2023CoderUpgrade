---
title: "SCRGOT 2023 Coder Upgrade Registration and Planning"
author: "Ryan Roberts"
date: "2/15/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(reactable)
library(reactablefmtr)
library(patchwork)

theme_set(theme_classic())

# Workaround for reactable not rendering in knitted document
# reactable <- function(...) {
#   htmltools::tagList(reactable::reactable(...))
# }
```

## Import and reorganize the registration data

Data from the Microsoft Forms registration process have been dowloaded as xlsx and converted to csv for import. This chunk will load data, discard unnecessary elements, simplify labels, and create vectors needed for downstream processes.

```{r import_data}
reg <- read.csv("CoderUpgradeRegistration.csv", header = T) %>%
    as_tibble() %>%
    select(-ID, -Start.time, -Completion.time, -Email, -Name,
        -The..tentative..schedule)

colnames(reg) <- c(
        "Name",
        "Email",
        "In_or_Ex",
        "Skill",
        "Mentor",
        "Participant",
        "Social",
        "Dietary",
        "Laptop",
        "Cluster"
    )

sessions <- c(
    "Basics of R",
    "Intro to scRNA-seq",
    "Intro to Seurat",
    "Combining single cell datasets",
    "Differential expression analysis",
    "Under the hood",
    "Speeding it up",
    "Cell-cell interaction analysis",
    "Multiomic",
    "RNA velocity and pseudotime"
)

reg$Skill[reg$Skill == "Total noob"] <- "Noob"
reg$Skill[reg$Skill == "Beginner comfortable with the basics"] <- "Beginner"
reg$Skill[reg$Skill == "Intermediate with a few advanced skills"] <- "Intermediate"
reg$Skill[reg$Skill == "Expert who could teach all of the beginner topics"] <- "Expert"

reg$Cluster[reg$Cluster == "Yes - NCH cluster (Franklin)"] <- "Yes-NCH"
reg$Cluster[reg$Cluster == "Yes - other cluster (OSU OSC or other)"] <- "Yes-other"
```

## Generate class rosters

Process the data to generate lists of students enrolled in each course and lists of experienced coders willing to mentor.

```{r rosters, results='asis'}
roster <- lapply(seq_along(sessions), function(s) {
    students <- reg %>%
        filter(grepl(sessions[s], Participant)) %>%
        select(Name, Email, In_or_Ex, Skill, Laptop, Cluster)
    mentors <- reg %>%
        filter(grepl(sessions[s], Mentor)) %>%
        select(Name, Email, In_or_Ex, Skill)
    return(list(students = students, mentors = mentors))
})

for(s in seq_along(sessions)) {
    t1 <- reactable(roster[[s]]$students, pagination = F) %>%
        add_title(paste("Participant Roster - ", sessions[s], "(",
            length(roster[[s]]$students$Name), ")"))
    print(t1)
    p1 <- as.data.frame(table(roster[[s]]$students$Skill)) %>%
        ggplot(aes(factor(Var1, level = c(
                "Noob",
                "Beginner",
                "Intermediate",
                "Expert")),
            Freq, fill = Var1)) +
            geom_bar(stat = "identity") +
            scale_fill_manual(values = c("#D43F3AFF", "#EEA236FF",
                "#357EBDFF", "#5CB85CFF")) +
            theme(axis.title = element_blank(),
                legend.position = "none",
                axis.text.x = element_text(angle = 60, hjust = 1))
    p2 <- as.data.frame(table(roster[[s]]$students$Laptop)) %>%
        ggplot(aes(factor(Var1, level = c(
                "Yes",
                "No",
                "Maybe")),
            Freq, fill = Var1)) +
            geom_bar(stat = "identity") +
            scale_fill_manual(values = c("#D43F3AFF", "#EEA236FF",
                "#357EBDFF", "#5CB85CFF")) +
            theme(axis.title = element_blank(),
                legend.position = "none",
                axis.text.x = element_text(angle = 60, hjust = 1))
    p3 <- as.data.frame(table(roster[[s]]$students$Cluster)) %>%
        ggplot(aes(factor(Var1, level = c(
                "Yes-NCH",
                "Yes-other",
                "No")),
            Freq, fill = Var1)) +
            geom_bar(stat = "identity") +
            scale_fill_manual(values = c("#D43F3AFF", "#EEA236FF",
                "#357EBDFF", "#5CB85CFF")) +
            theme(axis.title = element_blank(),
                legend.position = "none",
                axis.text.x = element_text(angle = 60, hjust = 1))
    p4 <- p1 | p2 | p3
    print(p4 + plot_annotation(title = paste(sessions[s], "session")))
    t2 <- reactable(roster[[s]]$mentors, pagination = F) %>%
        add_title(paste("Mentor List - ", sessions[s], "(",
            length(roster[[s]]$mentors$Name), ")"))
    print(t2)
}

```

