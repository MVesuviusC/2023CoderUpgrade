---
title: "Intro to R 2023"
author: "Matt Cannon"
edits: "Luda Popova"
date: '2032-04-10'
output: html_document
---

# Part 1

## Overview

-- RStudio overview and layout.

-- R markdown, creating an Rmd file.

R markdown is a way to combine plain text, your R code, and results from your data analysis (including plots and tables) into a nicely formatted and reproducible document. 

https://intro2r.com/what-is-r-markdown.html

-- In general, when naming files in R, avoid using dots in file names, try to stick to numbers, letters, underscores, and dashes.

-- To create a new R chunk in an Rmd file, use Code/Insert Chunk, ctrl + alt + i (Windows), or cmd + option + i (macOS).

-- What is a variable?

-- What's a function? Arguments for functions. Reading function documentation. 
  
  
## Variables and basic data types 

"=" or "<-" is an assignment operator.

Variables in R can be used to store letters, numbers, and various data structures. To create a new variable, simply assign a value to a name.

Fundamental data types in R include: numeric, integer, complex, character, and logical. 

Here, we create a variable holding character data. Characters are enclosed in quotes. 

```{r}
my_name <- "Matt" 
```

You can use class(my_name) to examine to which data type does the variable my_name belong.

```{r}
class(my_name)
```

Here, we create a variable holding numeric data.

```{r}
count = 10 

class(count)
```

Here, we create a variable holding logical (boolean) data.

```{r}
bool1 = TRUE

bool2 = FALSE

class(bool1)

class(bool2)
```

A variable can hold multiple values, which can be joined by using c(value1, value2, value3, value4).

```{r}
months = c("Dec", "Apr", "Jan", "Mar")
```

## Factors

Variables can be continuous and categorical. Continuous can assume an infinite number of values within a given interval. Categorical variables have a fixed and known set of possible values.

In R, factors are used to work with categorical variables. They are also useful when you want to display character vectors in a non-alphabetical order (https://r4ds.had.co.nz/factors.html#:~:text=In%20R%2C%20factors%20are%20used,to%20work%20with%20than%20characters)

```{r}
months = c("Dec", "Apr", "Jan", "Mar")

sort(months)

months_factor = factor(months, levels = c("Jan", "Mar", "Apr", "Dec"))

sort(months_factor)
```


## Functions

sort() and class() from examples above are functions. Functions are sets of statements that are designed to perform a specific task (https://www.tutorialspoint.com/r/r_functions.htm). Functions have arguments, which the user can pass to them. In R, there are a lot of in-built functions. Some examples of in-built fuctions include mean(), max(), sum(), min() (https://www.tutorialspoint.com/r/r_functions.htm). Also, in R users can define their own functions, but we won't go over this in this session. 


```{r}
numbers = c(1,2,3,4,5)

min(numbers)

max(numbers)

sum(numbers)

mean(numbers)
```

It's impossible (and not necessary) to know all the functions and/or their arguments.You can use the help() function to get

more information about any function you want to use.  

```{r}
help(min)

help(max)

help(sum)

help(mean)
```

## Naming rules in R 

There are a few rules for naming variables in R. If possible names should be short and meaningful, and should include numbers, letters, _, and -. Avoid using

special characters in names. Also, R is case-sensitive. 

# Activity one 

Create a new Rmd file.

Within that file, create two variables holding numerical data.

Knowing that +, -, /, and * work like regular arithmetic operators in R, add your two variables together.

Create two variables holding the following values: "10" and "1". Make sure to enclose your variables in quotes. 

Try adding your two new variables together. Observe the error message. 

Using as.numeric() function, try to fix the error. 

Create a set of categorical variables specifying days of the week. Convert them to factors, specifying the correct order. 

Use sort() function to make sure everything worked. 


```{r}
v1 = "1"

v2 = "10"

as.numeric(v1) + as.numeric(v2)

days = c("Monday", "Tuesday", "Thursday", "Wednesday", "Friday")

sort(days)

days_f = factor(days, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday"))

sort(days_f)
```


# Part 2 

## Reading in files

Data are usually available to us in form of larger files, i.e. not single variables. There are functions in R that enable us to read in files. read.delim() can be used to read in text (.txt) files. 

```{r}
westernQuant <- read.delim("westernQuant.txt", header = TRUE)

westernQuant
```

Data frames are very useful data structures in R.  westernQuant is a data frame.

```{r}
class(westernQuant)
```

A data frame is a table or a two-dimensional array-like structure in which each column contains values of one variable and each row contains one set of values from each column. This is similar to an Excel sheet. 

Data frames have the following characteristics (https://www.tutorialspoint.com/r/r_data_frames.htm):

The column names should be non-empty.
The row names should be unique.
The data stored in a data frame can be of numeric, factor or character type.
Each column should contain same number of data items.

Once we read in a data frame, we can manipulate the data it contains. 

Here, we use an $ operator to access a column in a data frame.

```{r}
westernQuant$group_name
```


Square brackets can be used to subset the data frame. 

data_frame[row(s), column(s)], empty means everything.

R will not evaluate rows that start with "#", therefor hashtags are used to include comments in your code. 

```{r}
# first row, first column (just one element)
westernQuant[1, 1]

# First row, all columns
westernQuant[1, ]

# First column, all rows
westernQuant[, 1]

# First 5 rows, all columns
westernQuant[c(1:5), ]
```

Also, functions head() and tail() can be used to retrieve the first and the last six rows of a data frame, respectively. 

```{r}
head(westernQuant)

tail(westernQuant)
```

We can also use functions to look at data. 

```{r}
summary(westernQuant)
```

We can use the functions from the previous section. 

```{r}
min(westernQuant$intensity_gene1)

max(westernQuant$intensity_gene1)

mean(westernQuant$intensity_gene1)
```

Many functions will return an error if the data contain NAs. To overcome this issue, you need to include an na.rm = TRUE argument. 

```{r}
min(westernQuant$intensity_gene2)

max(westernQuant$intensity_gene2)

mean(westernQuant$intensity_gene2)

min(westernQuant$intensity_gene2, na.rm = TRUE)

max(westernQuant$intensity_gene2, na.rm = TRUE)

mean(westernQuant$intensity_gene2, na.rm = TRUE)
```

We can use fnnction to make visualizations. Here, we use our data to make a boxplot. 

```{r plot}
boxplot(westernQuant$intensity_gene1 ~ westernQuant$group_name, data = westernQuant)
```
Here, we make a histogram of our data. 

```{r}
hist(westernQuant$intensity_gene1)
```
## Activity 2

-- Make sure to save the summary output to a variable 

### Use read.csv to read in a 
### Read in data
Use read.delim()
```{r readData}

```

### Summarize the data.frame
Use summary()
```{r summaryWestern}

```

### Test for group differences -- use help()
Use t.test() function
```{r testDiff}

```

### Barplots
Use barplot()
```{r plots}

```


# Part 3

## Packages 

R packages are a collection of R functions, complied code and sample data (https://www.tutorialspoint.com/r/r_packages.htm). Packages are usually created to address a very specific need in data analysis. 

Tidyverse is a very useful collection of packages. Tidyverse is an opinionated collection of R packages designed for data science (includes ggplot2, dplyr, and other ones). All packages share an underlying design philosophy, grammar, and data structures.

https://www.tidyverse.org/

Packages need to be installed and loaded into the session before they can be used.

Some packages come from The Comprehensive R Archive Network (CRAN) with install.packages(), other packages can be installed through Bioconductor through BiocManager::install(). Best way to find out how to install a given package is to Google the specific package. 

```{r}
#install.packages("tidyverse")

library(tidyverse)

# Backup plan if you run into lots of errors there...

#install.packages(c("dplyr", "ggplot2"))

library(dplyr)

library(ggplot2)
```

Tidyverse packages use the pipe operator %>%

Several useful tidyverse functions:

mutate() adds a new column to a data frame 

```{r}
westernQuant = westernQuant%>%
  mutate(intensity_gene1_log = log2(intensity_gene1))
westernQuant
```
select() allows to select a certain column or several columns.

```{r}
westernQuant%>%
  select(intensity_gene1, group_name)
```

rename() allows to rename a column.

```{r}
westernQuant %>% 
  rename(Group = group_name)
```
arrange() allow us to order a column by values, in ascending or descending order. 

```{r}
arranged1 = westernQuant %>%
  arrange(intensity_gene1)
  
head(arranged1)

tail(arranged1)

arranged2 = westernQuant %>%
  arrange(-intensity_gene1)

head(arranged2)

tail(arranged2)
```

summarize() and group_by(). group() silently divides up rows by categories, and summarize() summarizes data within groups in a data frame. This makes a new column and drops all unnecesary columns. 

```{r}
westernQuant %>%
  group_by(group_name) %>%
  summarize(mean_mpg = mean(intensity_gene1))
```


### pivot_longer()
wide data vs long data
"tidy" data - https://www.youtube.com/watch?v=K-ss_ag2k9E explanation starts ~ 6 min in
https://epirhandbook.com/en/images/pivoting/pivot_longer_new.png
```{r}
# wide data
income


# long data
long_data <-
  relig_income %>%
  pivot_longer(!Species,
               names_to = "income",
               values_to = "count")

# Make it wider
wide_again <-
  long_data %>%
  pivot_wider(names_from = "income",
              values_from = "count")
```

left_join, right_join, inner_join, outer_join, anti_join

### Write a table out to a text file
```{r}
write.table(wide_again,
            file = "exampleOutput.txt",
            quote = FALSE,
            sep = "\t",
            row.names = FALSE)

write_tsv(wide_again,
          file = "exampleOutputAlso.txt")
```



### 

## Activity

### Read in and check out the Titanic data
```{r}

```

### Make variables that contain the Mean/median/min/max of age/fare
```{r}

```

### Use filter to make two new dataframe variables with just male and female only and then calculate the mean/median values for age and fare
Basically, calculate the mean/median age and fare for men vs women
```{r}

```

### Make a histogram of the age all passengers
```{r}

```

### Make another histogram for only passengers who survived

## If you're super fast

### Use `aov()` to test which factors influenced who survived the titanic disaster
```{r}

```

### Use table() to compare how many women vs men survived
```{r}

```


# 

## General stuff

### Common error messages
```{r, eval=FALSE}
mean(bob)
#Error in mean(bob) : object 'bob' not found
```
R is looking for a variable named bob, but it doesn't exist
-   Either make it
-   Check spelling/capitalization
-   You forgot to put quotes around a character string

```{r, eval=FALSE}
arbleGarble(mtcars)
#Error in arbleGarble(mtcars) : could not find function "arbleGarble"
```
R is trying to use the function `arbleGarble()`, but it doesn't exist
-   Either load in the library that has it
    -   (or use `coolLib::arbleGarble()`)
-   Check spelling/capitalization

```{r, eval=FALSE}
hist(mtcars$mpg, n = 20
# +
((((((1))))))
```
R thinks you have unfinished business here
-   Hit escape to cancel the command
-   Most likely you're missing a parenthesis or a quotation mark somewhere
-   rainbow brackets!

### googling error messages

### googling "R how do I…"

---

## Functions for today's activity





## Activity

### Read in patientGroups.txt and exercise.txt
patientGroups.txt is patient #, treatment groups and final blood glucose measurements apatientGroups.txt is patient #, treatment groups and final blood glucose measurementspatientGroups.txt is patient #, treatment groups and final blood glucose measurementspatientGroups.txt is patient #, treatment groups and final blood glucose measurementspatientGroups.txt is patient #, treatment groups and final blood glucose measurementspatientGroups.txt is patient #, treatment groups and final blood glucose measurementspatientGroups.txt is patient #, treatment groups and final blood glucose measurements
exercise.txt is the how many minutes each patient exercised across five days
```{r}

```


### Combine the datasets into a single data.frame
```{r}

```

### Pivot the data to long form
Columns should be patient, day, exercise_min, glucose
```{r}

```

### Save the pivoted data.frame to a text file with write.table() or write_tsv()
```{r}

```

### Make a new column where glucose is multiplied by 1000
```{r}

```

### Calculate the average daily minutes of exercise per patient
```{r}

```

## If you’re super fast

### Plot glucose levels for each group (treated/control)
```{r}

```

### Test if glucose levels are statistically different between groups
```{r}

```

### Plot daily exercise minutes per group
```{r}

```

### Test if exercise minutes is statistically different between groups
```{r}

```





# Part 4 

## General stuff

## GGplot

### geoms as layers
https://ggplot2.tidyverse.org/reference/

## Functions for today's activity, also for reference

### ggplot
ggplot(data_frame_here, aes(x = x_here, y = y_here, other_stuff)) +
layer_1 +
layer_2 +
layer_3 +
. +
. +
. +
modify_the_plot_somehow

#### geom_point() ##############################################################
Add a scatterplot layer to the plot
```{r}
ggplot(mtcars,
       aes(x = hp,
           y = carb)) +
  geom_point()

# Set the overall look of the plot - I like the white background better than gray
theme_set(theme_bw())
theme_update(plot.title = element_text(hjust = 0.5))

ggplot(mtcars,
       aes(x = hp,
           y = carb)) +
  geom_point() +
  theme_bw()
```

#### aes(fill/color/shape/size) ################################################
Change colors/shapes/etc

If you put the argument outside of aes()

-   applies to everything in that layer
-   does not show up in the legend

If you put it inside aes()

-   Applies to parts of the layer
-   Shows up in legend

If it is in the aes() call inside of ggplot() `ggplot(aes(...))`

-   It applies to all layers
-   Unless that layer overwrites it

```{r}
mtcars %>%
  ggplot(aes(x = as.factor(cyl),
             y = hp)) +
  geom_boxplot(color = "red",
               fill = "blue",
               size = 4)

ggplot(mtcars,
       aes(x = hp,
           y = carb,
           color = as.factor(vs),
           shape = as.factor(gear),
           size = disp)) +
  geom_point()
```

#### geom_histogram()
Better looking than hist()
Specify how many bars to show with `bins`
```{r}
hist(storms$pressure, n = 200)

ggplot(storms,
       aes(x = pressure)) +
  geom_histogram(bins = 200)
```


#### geom_col() ################################################################
Add a barplot layer to the plot
```{r}
mtcars %>%
  rownames_to_column("car_make") %>%
  mutate(car_make = str_remove(car_make," .+")) %>%
  ggplot(aes(x = car_make, y = hp)) +
  geom_col(color = "red") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ggtitle("this is a title") +
  theme_update(plot.title = element_text(hjust = 0.5))

mtcars %>%
  rownames_to_column("car_make") %>%
  ggplot(aes(y = car_make, x = hp)) +
  geom_col()
```

#### labs()
Add labels
```{r}
ggplot(mtcars) +
  geom_point(aes(x = hp, y = disp)) +
  labs(x = "X label goes here",
       y = "Y label goes here",
       title = "This is a title",
       subtitle = "Subtitle!",
       caption = "Cannon et al, 2034!",
       tag = "A")
```


#### theme()
A good guide to what theme elements are what:
https://henrywang.nl/ggplot2-theme-elements-demonstration/

You can change just about any aspect of how the plot looks with theme()
You'll have to look up how to change each specific bit
```{r}
ggplot(storms,
       aes(x = pressure,
           fill = category)) +
  # alpha sets transparency - 0 is clear, 1 is opaque
  geom_density(alpha = 0.5) +
  # The brewer color palettes are pretty, and "Set2" is color-blind friendly
  scale_color_brewer(palette = "Set2") +
  theme(legend.position = c(0.2, 0.9),
        legend.direction = "horizontal",
        legend.key.width = unit(2, "cm"),
        legend.title = element_text(face = "bold"),
        strip.background = element_rect(color = "white", fill = "white"),
        strip.text.x = element_text(size = 30, face = "bold"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line.x = element_line(color = "black"),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())
```

### ggsave()
```{r}
ggsave("examplePlot.png",
       width = 10,
       height = 8)

plot_in_variable <-
  ggplot(dplyr::storms,
         aes(x = pressure)) +
  geom_histogram(bins = 100) +
  facet_wrap(~ category)

# ggsave will get the plot size from how big your "plot" windows is in the right pane if you don't specify it!!!!!
ggsave("anotherExamplePlot.png",
       plot = plot_in_variable)
```

### Include pdf() and png()
### dev.off()

## Activity

## Recreate plots from paper

Data is from https://doi.org/10.1371/journal.pbio.2005756

Najafov A, Zervantonakis IK, Mookhtiar AK, Greninger P, March RJ, Egan RK, et al. (2018) BRAF and AXL oncogenes drive RIPK3 expression loss in cancer. PLoS Biol 16(8): e2005756. https://doi.org/10.1371/journal.pbio.2005756

I downloaded their figure data and made it easier to import:
-   Fig1A_partial.txt
-   Fig1C.txt
-   Fig2F.txt
-   Fig3F.txt

#### Figure 1A – geom_boxplot()
```{r}

```

#### Figure 1C – heatmap()
```{r}

```

#### Figure 2F – geom_point()
```{r}

```

#### Figure 3F – geom_col
use geom_errorbars()
and facet_wrap() to split the plots by cell_line
```{r}

```

## If you’re super fast:
Keep going, do the rest 🙃

Download the data from the supplemental data here:

https://doi.org/10.1371/journal.pbio.2005756.s001

